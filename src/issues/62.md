---
layout: post
issue: 62
title: "Power measurements and CO2e estimates in Firefox Profiler"
description: "This week will be a quick look at power usage profiling that's available in Firefox Dev Tools Profiler, and the accompanying CO2e measurements."
published: '2023-02-03 00:00'
excerpt: "This week will be a quick look at power usage profiling that's available in Firefox Dev Tools Profiler, and the accompanying CO2e measurements."
tags: ["web sustainability"]
canonical: https://fershad.com/writing/co2e-estimates-in-firefox-profiler/
---

It's been a heck of a fortnight. Funerals, celebrations, booking our first overseas trip in years, and a lot happening on the work front too. I'm definitely looking forward to a few days of rest and relaxation when we're away in Germany in the middle of next month. I'll be there to meet up with The Green Web Foundation team. It's the first time I'll be meeting any of the people I've worked for the better part of a year with so that's bloody exciting.

This week will be a quick look at power usage profiling that's available in Firefox Dev Tools Profiler, and the accompanying CO2e measurements which I helped to get merged in.

***
<!-- # Power measurements and CO2e estimates in Firefox Profiler -->

Earlier this year, an update to the Firefox Dev Tools Profiler was merged into production (Jan. 10, 2023 - [here's the PR](https://github.com/firefox-devtools/profiler/pull/4414)). It includes a merge of some code I helped author which surfaced carbon emissions estimates for power measurements made using the profiler. You may remember me using a pre-release version of this when I [audited the COP27 website](https://fershad.com/writing/cop27-egypt-a-webpage-sustainability-review/) last year.

Having code merged into a Mozilla project is wild. It's even cooler when it gets a shout out at [FOSDEM](https://fosdem.org/2023/schedule/event/energy_power_profiling_firefox/).

## What is the Firefox Profiler?

In a nutshell, the Firefox Profiler is a Developer Tool in the Firefox browser that can be used to capture a performance profile of browser usage. This profile contains extremely low-level detail on the processes and functions that were being run at the time it was capture, and is extremely useful for debugging performance issues, memory leaks, and much more.

### Power measurements in Firefox Profiler

[As of Firefox 104](https://www.mozilla.org/en-US/firefox/104.0/releasenotes/), the profiler has been able to capture power usage. About a month ago I had the pleasure of talking with Florian Quèze, one of the developers responsible for getting this feature into the Profiler. As you can imagine, capturing the power profile of a browser is no easy feat, and there's a bunch of important caveats to keep in mind if you do go ahead and use it.

1. The power profile that is capture on Intel CPU devices is that of the _entire system_. That means if you've got a whole bunch of background apps running, their power usage will be captured too.

- On AMD CPUs, you can get power profiles broken down per core, but again they capture _entire system_ power draw.
- On Apple Silicon CPUs, you can get a _per process_ breakdown. This should allow you to isolate the power track for the browser window that is being captured.

2. Capturing power profiles works well on Windows 11 and Apple Mac devices, but needs some manual steps to work on Linux. I've not yet managed to get it going on my Linux device.

- It's currently not possible to capture the power profile of a mobile device.

### CO2e estimates in the Firefox Profiler

The CO2e (carbon dioxide equivalent) emissions estimates that I helped add to the Profiler are pretty straight forward. It works by:

1. Taking the power figures recorded by the profiler and converting them to kilowatt-hours.
2. Multiplying this value by 442 g/kWh (the global average grid intensity in grams of one kilowatt-hour).

Ideally, we’d like to use region-specific figures for even greater detail. There’s been [some conversation](https://github.com/firefox-devtools/profiler/pull/4243#issuecomment-1266624528) [around this](https://github.com/firefox-devtools/profiler/pull/4243#issuecomment-1270018399) as part of the PR for this feature. I expect we'll be able to get something like this implemented sometime this year.

## Recording a profiler

Another thing that came out of my chat with Florian, was that he recommended using the Profiler Toolbar Extension for Firefox when capturing power profiles. The reason, he said, was that they had put in a lot of work into making the extension consume as little power as possible so as not to impact the results of the recording. To add it to your Toolbar, go to <https://profiler.firefox.com> and click on the _Enable Firefox Profiler Menu Button_.

***

The next issue of Optimised will be in your inbox on March 3rd. The website has an **[archive of all previous emails](https://optimised.email/)**. It's a good place to recap on anything we've covered, and also handy to share with friends or colleagues. As always if you've got any feedback or specific topics you want to be covered then just reply to this email.

Keep safe, stay well.  
Fershad.
